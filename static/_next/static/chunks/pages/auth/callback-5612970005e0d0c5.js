(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[577],{88575:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/callback",function(){return r(88545)}])},88545:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h},dynamic:function(){return d}});var a=r(85893),c=r(67294),n=r(11163),o=r(77833),s=r(96180),l=r(11629);let i=()=>(0,l.Eu)();var u=r(97258);let d="force-static";function h(){let e=(0,n.useRouter)(),{login:t}=i(),[r,l]=(0,c.useState)(null);(0,c.useEffect)(()=>{d()},[e.query]);let d=async()=>{let{code:r,error:a}=e.query;if(!r){if(!localStorage.getItem("access_token")){let t=localStorage.getItem("auth_redirect")||"/dashboard";e.replace("/login?next=".concat(encodeURIComponent(t)))}return}if(a){l("Error en la autenticaci\xf3n. Por favor, intenta nuevamente."),setTimeout(()=>e.push("/login"),3e3);return}if(r&&"string"==typeof r)try{let a=sessionStorage.getItem("oauth_redirect_uri"),s=new URL("".concat((0,u.X)(),"/api/auth/google/callback"));s.searchParams.set("code",r),a&&s.searchParams.set("redirect_uri",a),console.log("[OAuth] Calling backend callback",{url:s.toString(),redirectOverride:a});let l=await fetch(s.toString(),{method:"GET"});if(l.ok){var c,n,o;let r=await l.json();await t(r.access_token,r.user);let a=localStorage.getItem("auth_redirect");a?((null===(n=r.user)||void 0===n?void 0:n.role)==="teacher"&&"/dashboard"===a&&(a="/dashboard/teacher"),(null===(o=r.user)||void 0===o?void 0:o.role)!=="teacher"&&"/dashboard/teacher"===a&&(a="/dashboard")):a=(null===(c=r.user)||void 0===c?void 0:c.role)==="teacher"?"/dashboard/teacher":"/dashboard",localStorage.removeItem("auth_redirect"),console.log("[OAuth] Redirecting to",a),e.push(a)}else throw Error("Error procesando autenticaci\xf3n")}catch(t){console.error("Error en callback:",t),l("Error procesando la autenticaci\xf3n. Por favor, intenta nuevamente."),setTimeout(()=>e.push("/login"),3e3)}};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsx)(o.w,{className:"p-8 max-w-md w-full",children:r?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-red-500 mb-4",children:"⚠️"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Error de Autenticaci\xf3n"}),(0,a.jsx)("p",{className:"text-gray-600",children:r}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"Redirigiendo..."})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(s.c,{size:"lg",color:"primary"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mt-4 mb-2",children:"Procesando autenticaci\xf3n"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Por favor espera un momento..."})]})})})}}},function(e){e.O(0,[929,888,774,179],function(){return e(e.s=88575)}),_N_E=e.O()}]);