(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[400],{91250:function(e,t,a){Promise.resolve().then(a.bind(a,12088))},12088:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return L}});var s=a(57437),n=a(2265),r=a(76362),i=a(75265),l=a(93649),c=a(49365),o=a(15035),d=a(99008),u=a(72784),h=a(47752),m=a(10134),x=a(94294),j=a(38793),f=a(64087),g=a(53168),p=a(10974),v=a(1513),b=a(29721),y=a(35069),w=a(27985),N=a(13706),S=a(88139);let k=((0,a(74780).X)()+"/api").replace(/\/$/,"");async function C(e){let t=await fetch("".concat(k,"/assignments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Error creating assignment");return t.json()}async function _(e){let t=e?"".concat(k,"/assignments?teacher_id=").concat(encodeURIComponent(e)):"".concat(k,"/assignments"),a=await fetch(t);if(!a.ok)throw Error("Error listing assignments");return a.json()}async function E(e,t,a){let s=await fetch("".concat(k,"/submissions/").concat(e,"/grade"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grade:t,feedback:a})});if(!s.ok)throw Error("Error grading submission");return s.json()}async function A(e){let t=await fetch("".concat(k,"/assignments/").concat(e,"/submissions"));if(!t.ok)throw Error("Error listing submissions");return t.json()}async function P(e,t){let a=await fetch("".concat(k,"/assignments/").concat(e,"/status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(!a.ok)throw Error("Error updating status");return a.json()}var z=a(82431),O=a(99397);function T(e){let{teacherId:t}=e,{user:a}=(0,r.a)(),k=t||(null==a?void 0:a.id),{isOpen:T,onOpen:I,onOpenChange:X}=(0,i.q)(),[D,L]=(0,n.useState)([]),[R,Y]=(0,n.useState)(!1),[F,B]=(0,n.useState)({title:"",description:"",subject:"",due_date:""}),[J,G]=(0,n.useState)(!1),[M,V]=(0,n.useState)(null),[Z,q]=(0,n.useState)([]),[U,W]=(0,n.useState)(null),[$,H]=(0,n.useState)(!1),[K,Q]=(0,n.useState)({}),ee=async()=>{Y(!0);try{let e=await _(k);L(e.assignments||[])}catch(e){console.error(e)}finally{Y(!1)}};(0,n.useEffect)(()=>{k&&ee()},[k]);let et=async()=>{G(!0);try{await C({...F,creator_teacher_id:k}),X(),B({title:"",description:"",subject:"",due_date:""}),ee()}catch(e){console.error(e)}finally{G(!1)}},ea=async e=>{V(e);try{let t=await A(e.id);q(t.submissions||[])}catch(e){console.error(e)}},es=async e=>{let t=K[e];if(t&&""!==t.grade){W(e);try{await E(e,parseFloat(t.grade),t.feedback||"");let a=await A(M.id);q(a.submissions||[])}catch(e){console.error(e)}finally{W(null)}}},en=async e=>{if(M){H(!0);try{let t=await P(M.id,e);V(t.assignment),ee()}catch(e){console.error(e)}finally{H(!1)}}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(l.w,{children:[(0,s.jsxs)(c.u,{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"font-semibold",children:"Tareas / Asignaciones"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(o.A,{size:"sm",variant:"flat",onPress:ee,startContent:(0,s.jsx)(z.Z,{size:16}),children:"Refrescar"}),(0,s.jsx)(o.A,{size:"sm",color:"primary",startContent:(0,s.jsx)(O.Z,{size:16}),onPress:I,children:"Nueva"})]})]}),(0,s.jsx)(d.G,{children:(0,s.jsxs)(u.b,{"aria-label":"Listado de tareas",children:[(0,s.jsxs)(h.J,{children:[(0,s.jsx)(m.j,{children:"T\xedtulo"}),(0,s.jsx)(m.j,{children:"Materia"}),(0,s.jsx)(m.j,{children:"Vence"}),(0,s.jsx)(m.j,{children:"Estado"}),(0,s.jsx)(m.j,{children:"Creada"})]}),(0,s.jsx)(x.y,{emptyContent:R?"Cargando...":"Sin tareas",items:D,children:D.map(e=>(0,s.jsxs)(j.g,{onClick:()=>ea(e),className:"cursor-pointer hover:bg-default-100",children:[(0,s.jsx)(f.X,{children:e.title}),(0,s.jsx)(f.X,{children:e.subject}),(0,s.jsx)(f.X,{children:e.due_date?new Date(e.due_date).toLocaleDateString():"-"}),(0,s.jsx)(f.X,{children:(0,s.jsx)(g.z,{size:"sm",color:"active"===e.status?"success":"default",children:e.status})}),(0,s.jsx)(f.X,{children:new Date(e.created_at).toLocaleDateString()})]},e.id))})]})})]}),(0,s.jsx)(p.R,{isOpen:T,onOpenChange:X,placement:"center",children:(0,s.jsx)(v.A,{children:e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.k,{children:"Nueva Asignaci\xf3n"}),(0,s.jsxs)(y.I,{children:[(0,s.jsx)(w.Y,{label:"T\xedtulo",value:F.title,onChange:e=>B(t=>({...t,title:e.target.value}))}),(0,s.jsx)(w.Y,{label:"Materia",value:F.subject,onChange:e=>B(t=>({...t,subject:e.target.value}))}),(0,s.jsx)(w.Y,{type:"date",label:"Fecha l\xedmite",value:F.due_date,onChange:e=>B(t=>({...t,due_date:e.target.value}))}),(0,s.jsx)(N.Y,{label:"Descripci\xf3n",value:F.description,onChange:e=>B(t=>({...t,description:e.target.value}))})]}),(0,s.jsxs)(S.R,{children:[(0,s.jsx)(o.A,{variant:"light",onPress:e,children:"Cancelar"}),(0,s.jsx)(o.A,{color:"primary",isLoading:J,onPress:et,children:"Crear"})]})]})})}),(0,s.jsx)(p.R,{isOpen:!!M,onOpenChange:()=>V(null),size:"3xl",scrollBehavior:"inside",children:(0,s.jsx)(v.A,{children:e=>M&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(b.k,{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold",children:M.title}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Materia: ",M.subject," • Vence: ",M.due_date?new Date(M.due_date).toLocaleDateString():"—"]})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)(o.A,{size:"sm",variant:"flat",isLoading:$,onPress:()=>en("active"===M.status?"closed":"active"),children:"active"===M.status?"Cerrar":"Reabrir"})})]}),(0,s.jsxs)(y.I,{children:[(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap mb-4",children:M.description}),(0,s.jsxs)("h5",{className:"font-medium mb-2",children:["Entregas (",Z.length,")"]}),(0,s.jsxs)("div",{className:"space-y-4",children:[Z.map(e=>{var t,a;return(0,s.jsx)(l.w,{className:"border border-default-200",children:(0,s.jsxs)(d.G,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm font-semibold",children:["Estudiante: ",e.student_id]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Entregada: ",new Date(e.submitted_at).toLocaleString()]})]}),(0,s.jsx)(g.z,{size:"sm",color:null!=e.grade?"primary":"warning",children:null!=e.grade?"Nota ".concat(e.grade):"Sin nota"})]}),(0,s.jsx)("p",{className:"text-sm bg-default-50 rounded p-2 mb-3 whitespace-pre-wrap max-h-40 overflow-auto",children:e.content}),(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-end",children:[(0,s.jsx)("div",{className:"col-span-2",children:(0,s.jsx)(w.Y,{label:"Nota",size:"sm",type:"number",min:0,max:10,value:(null===(t=K[e.id])||void 0===t?void 0:t.grade)||"",onChange:t=>Q(a=>{var s;return{...a,[e.id]:{grade:t.target.value,feedback:(null===(s=a[e.id])||void 0===s?void 0:s.feedback)||""}}})})}),(0,s.jsx)("div",{className:"col-span-7",children:(0,s.jsx)(N.Y,{label:"Feedback",size:"sm",value:(null===(a=K[e.id])||void 0===a?void 0:a.feedback)||"",onChange:t=>Q(a=>{var s;return{...a,[e.id]:{grade:(null===(s=a[e.id])||void 0===s?void 0:s.grade)||"",feedback:t.target.value}}})})}),(0,s.jsx)("div",{className:"col-span-3 flex justify-end",children:(0,s.jsx)(o.A,{size:"sm",color:"primary",isLoading:U===e.id,onPress:()=>es(e.id),children:"Guardar Nota"})})]})]})},e.id)}),0===Z.length&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Sin entregas a\xfan."})]})]}),(0,s.jsx)(S.R,{children:(0,s.jsx)(o.A,{variant:"light",onPress:e,children:"Cerrar"})})]})})})]})}var I=a(67640),X=a(38480),D=a(99376);function L(){let{user:e,loading:t,role:a}=(0,r.a)(),i=(0,D.useRouter)();return((0,n.useEffect)(()=>{if(!t){if(e)"teacher"!==a&&i.push("/dashboard");else{try{localStorage.setItem("auth_redirect","/dashboard/teacher")}catch(e){}i.push("/login")}}},[e,t,a,i]),t||!e||"teacher"!==a)?(0,s.jsx)("div",{className:"p-6",children:"Verificando permisos..."}):(0,s.jsxs)("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Panel Docente"}),(0,s.jsx)(I.n,{"aria-label":"Panel docente",variant:"bordered",children:(0,s.jsx)(X.r,{title:"Tareas",children:(0,s.jsx)(T,{teacherId:e.id})},"assignments")})]})}},49294:function(e,t,a){"use strict";a.d(t,{E:function(){return o}});var s=a(57437),n=a(2265),r=a(74780),i=a(57223),l=a(25922);let c=(0,n.createContext)(void 0),o=()=>{let e=(0,n.useContext)(c);if(!e)throw Error("useAuthContext debe usarse dentro de AuthProvider");return e};function d(e){let{children:t}=e,[a,i]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0),[d,u]=(0,n.useState)(null),h=(0,n.useCallback)(async()=>{try{let e=localStorage.getItem("access_token");if(!e){i(null),o(!1);return}let t=await fetch("".concat((0,r.X)(),"/api/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();i(e.user),u(null)}else localStorage.removeItem("access_token"),i(null)}catch(e){u("Error verificando autenticaci\xf3n"),i(null)}finally{o(!1)}},[]);(0,n.useEffect)(()=>{h()},[h]);let m=(0,n.useCallback)(async(e,t)=>{localStorage.setItem("access_token",e),i(t),u(null),o(!1)},[]),x=(0,n.useCallback)(async()=>{try{let e=localStorage.getItem("access_token");e&&await fetch("".concat((0,r.X)(),"/api/auth/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}})}catch(e){}finally{localStorage.removeItem("access_token"),i(null)}},[]),j=(0,n.useCallback)(async()=>{try{let e=localStorage.getItem("access_token");if(!e)return;let t=await fetch("".concat((0,r.X)(),"/api/auth/refresh"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();localStorage.setItem("access_token",e.access_token),await h()}else localStorage.removeItem("access_token"),i(null)}catch(e){}},[h]),f={user:a,loading:l,error:d,role:(null==a?void 0:a.role)||"student",login:m,logout:x,refreshToken:j,checkAuth:h,isAuthenticated:!!a,subscriptionTier:(null==a?void 0:a.subscription_tier)||"free"};return(0,s.jsx)(c.Provider,{value:f,children:t})}t.default=function(e){let{children:t}=e;return(0,s.jsx)(i.w,{children:(0,s.jsx)(l.f,{attribute:"class",defaultTheme:"light",themes:["light","dark","julia-light","julia-dark"],children:(0,s.jsx)(d,{children:t})})})}},76362:function(e,t,a){"use strict";a.d(t,{a:function(){return n}});var s=a(49294);let n=()=>(0,s.E)()},74780:function(e,t,a){"use strict";function s(){let e="http://localhost:8000";return e.endsWith("/")?e.slice(0,-1):e}a.d(t,{X:function(){return s}})}},function(e){e.O(0,[35,734,468,939,789,971,117,744],function(){return e(e.s=91250)}),_N_E=e.O()}]);