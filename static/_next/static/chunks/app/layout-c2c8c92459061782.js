(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{46268:function(e,t,n){Promise.resolve().then(n.bind(n,49294)),Promise.resolve().then(n.bind(n,36813)),Promise.resolve().then(n.t.bind(n,50911,23)),Promise.resolve().then(n.t.bind(n,47960,23))},49294:function(e,t,n){"use strict";n.d(t,{E:function(){return i}});var l=n(57437),a=n(2265),r=n(74780),s=n(57223),o=n(25922);let c=(0,a.createContext)(void 0),i=()=>{let e=(0,a.useContext)(c);if(!e)throw Error("useAuthContext debe usarse dentro de AuthProvider");return e};function u(e){let{children:t}=e,[n,s]=(0,a.useState)(null),[o,i]=(0,a.useState)(!0),[u,d]=(0,a.useState)(null),h=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("access_token");if(!e){s(null),i(!1);return}let t=await fetch("".concat((0,r.X)(),"/api/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();s(e.user),d(null)}else localStorage.removeItem("access_token"),s(null)}catch(e){d("Error verificando autenticaci\xf3n"),s(null)}finally{i(!1)}},[]);(0,a.useEffect)(()=>{h()},[h]);let f=(0,a.useCallback)(async(e,t)=>{localStorage.setItem("access_token",e),s(t),d(null),i(!1)},[]),m=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("access_token");e&&await fetch("".concat((0,r.X)(),"/api/auth/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}})}catch(e){}finally{localStorage.removeItem("access_token"),s(null)}},[]),v=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("access_token");if(!e)return;let t=await fetch("".concat((0,r.X)(),"/api/auth/refresh"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();localStorage.setItem("access_token",e.access_token),await h()}else localStorage.removeItem("access_token"),s(null)}catch(e){}},[h]),x={user:n,loading:o,error:u,role:(null==n?void 0:n.role)||"student",login:f,logout:m,refreshToken:v,checkAuth:h,isAuthenticated:!!n,subscriptionTier:(null==n?void 0:n.subscription_tier)||"free"};return(0,l.jsx)(c.Provider,{value:x,children:t})}t.default=function(e){let{children:t}=e;return(0,l.jsx)(s.w,{children:(0,l.jsx)(o.f,{attribute:"class",defaultTheme:"light",themes:["light","dark","julia-light","julia-dark"],children:(0,l.jsx)(u,{children:t})})})}},36813:function(e,t,n){"use strict";n.d(t,{default:function(){return f}});var l=n(57437);n(2265);var a=n(15035),r=n(88804),s=n(36290),o=n(18120),c=n(34914),i=n(17032),u=n(47692),d=n(76362),h=n(99376);function f(){let{user:e,logout:t,loading:n,isAuthenticated:f}=(0,d.a)(),m=(0,h.useRouter)();return n?null:f?(0,l.jsx)("div",{className:"flex items-center gap-3",children:(0,l.jsxs)(r.F,{placement:"bottom-end",children:[(0,l.jsx)(s.S,{children:(0,l.jsx)(a.A,{variant:"light",className:"px-2",startContent:(0,l.jsx)(o.h,{size:"sm",name:null==e?void 0:e.name,src:null==e?void 0:e.picture}),children:(null==e?void 0:e.name)||(null==e?void 0:e.email)})}),(0,l.jsxs)(c.a,{"aria-label":"Opciones de usuario",children:[(0,l.jsxs)(i.W,{className:"text-xs",isReadOnly:!0,color:"default",children:["Rol: ",(null==e?void 0:e.role)||"student"]},"role"),(0,l.jsx)(i.W,{color:"danger",startContent:(0,l.jsx)(u.Z,{size:14}),onPress:()=>t(),children:"Cerrar sesi\xf3n"},"logout")]})]})}):(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(a.A,{size:"sm",color:"primary",variant:"flat",onPress:()=>m.push("/login"),children:"Login"})})}},76362:function(e,t,n){"use strict";n.d(t,{a:function(){return a}});var l=n(49294);let a=()=>(0,l.E)()},74780:function(e,t,n){"use strict";function l(){let e="http://localhost:8000";return e.endsWith("/")?e.slice(0,-1):e}n.d(t,{X:function(){return l}})},47960:function(){}},function(e){e.O(0,[566,329,44,587,35,734,958,800,971,117,744],function(){return e(e.s=46268)}),_N_E=e.O()}]);